# 画面遷移図 - 人事管理

## 概要

人事管理機能は、宿泊施設のスタッフ情報と権限を管理するための機能群です。人事担当者がスタッフの登録・更新・削除、パスワード管理、権限ロールの割り当て・変更を行います。

## ユーザーロール

- **人事担当者**: スタッフの入退社管理、権限設定、アカウント管理を担当する責任者

## 画面一覧

| 画面名 | 目的 |
|--------|------|
| スタッフ一覧画面 | スタッフの検索・一覧表示・各種操作への導線 |
| スタッフ登録画面 | 新規スタッフの情報登録とアカウント発行 |
| スタッフ更新画面 | 既存スタッフの情報変更 |
| スタッフ削除確認画面 | 退職スタッフの削除とアカウント無効化 |
| パスワードリセット画面 | パスワードのリセットと仮パスワード発行 |
| 権限割り当て画面 | 新規スタッフへの権限ロール割り当て |
| 権限変更画面 | スタッフの権限ロール変更 |
| 権限検索画面 | 権限設定状況の検索・確認 |

---

## 人事担当者 ユーザーフロー

### メインフロー: スタッフ管理の起点

```
[スタッフ一覧画面]
    │
    ├─→ [新規登録] → [スタッフ登録画面]
    │
    ├─→ [編集] → [スタッフ更新画面]
    │
    ├─→ [削除] → [スタッフ削除確認画面]
    │
    ├─→ [パスワードリセット] → [パスワードリセット画面]
    │
    └─→ [権限変更] → [権限変更画面]
```

関連ユースケース:
- スタッフ一覧からの検索・選択

---

### フロー1: 新入社員受け入れフロー

```
[1] スタッフ一覧画面
    ↓ 「新規登録」をクリック
[2] スタッフ登録画面
    │ - 名前を入力
    │ - メールアドレスを入力
    │ - 電話番号を入力（任意）
    │ - 権限ロールを選択
    ↓ 「登録」をクリック
[3] 登録完了
    │ - スタッフ情報が保存される
    │ - アカウントが作成される
    │ - 初期パスワードがメール送信される
    ↓
[4] スタッフ一覧画面（戻る）
```

関連ユースケース:
- 新規スタッフの登録とアカウント発行
- 新入社員受け入れの一連フロー

---

### フロー2: スタッフ情報更新フロー

```
[1] スタッフ一覧画面
    ↓ 対象スタッフを検索・選択
[2] スタッフ一覧画面（スタッフ選択済み）
    ↓ 「編集」をクリック
[3] スタッフ更新画面
    │ - 現在の情報が表示される
    │ - 名前を編集
    │ - メールアドレスを編集
    │ - 電話番号を編集
    ↓ 「更新」をクリック
[4] 更新完了
    ↓
[5] スタッフ一覧画面（戻る）
```

関連ユースケース:
- スタッフ情報の更新

---

### フロー3: 退職スタッフ削除フロー

```
[1] スタッフ一覧画面
    ↓ 退職予定スタッフを検索・選択
[2] スタッフ一覧画面（スタッフ選択済み）
    ↓ 「削除」をクリック
[3] スタッフ削除確認画面
    │ - スタッフ情報が表示される
    │ - 削除理由を選択（退職/契約終了/その他）
    │ - 削除理由詳細を入力（任意）
    ↓ 「削除実行」をクリック
[4] 確認ダイアログ
    │ - 「本当に削除しますか？」
    ↓ 「確認」をクリック
[5] 削除完了
    │ - スタッフ情報が削除される
    │ - アカウントが無効化される
    ↓
[6] スタッフ一覧画面（戻る）
```

関連ユースケース:
- 退職スタッフの削除とアカウント無効化

---

### フロー4: パスワードリセットフロー（通常）

```
[1] スタッフ一覧画面
    ↓ 対象スタッフを選択 → 「パスワードリセット」をクリック
[2] パスワードリセット画面
    │ - スタッフ情報が表示される
    │ - リセット種別: 「通常リセット（パスワード忘れ）」を選択
    │ - 本人確認方法を選択（電話確認/対面確認/上長承認）
    │ - リセット理由を入力
    ↓ 「パスワードリセット実行」をクリック
[3] 確認ダイアログ
    ↓ 「確認」をクリック
[4] リセット完了
    │ - 仮パスワードが生成される
    │ - スタッフにメール通知される
    ↓
[5] スタッフ一覧画面（戻る）
```

関連ユースケース:
- パスワード忘れ時のリセット対応

---

### フロー5: パスワードリセットフロー（セキュリティインシデント）

```
[1] パスワードリセット画面（直接アクセス可）
    │ - 対象スタッフを検索・選択
    │ - リセット種別: 「強制リセット（セキュリティインシデント）」を選択
    │ - 本人確認方法を選択
    │ - 詳細なリセット理由を入力（必須）
    ↓ 「パスワードリセット実行」をクリック
[2] 確認ダイアログ
    │ - 「セキュリティインシデント対応として実行しますか？」
    ↓ 「確認」をクリック
[3] 強制リセット完了
    │ - パスワードが無効化・再生成される
    │ - 緊急通知が送信される
    ↓
[4] スタッフ一覧画面（戻る）
```

関連ユースケース:
- セキュリティインシデント時の強制パスワードリセット

---

### フロー6: 権限ロール割り当てフロー

```
[1] スタッフ一覧画面
    ↓ 権限未設定のスタッフを選択
[2] 権限割り当て画面
    │ - スタッフ情報が表示される
    │ - 現在の権限ロール: （未設定）
    │ - 権限ロールを選択
    │   ├─ Admin
    │   ├─ Reservation Manager
    │   ├─ Front Desk
    │   ├─ Housekeeping
    │   ├─ Accounting
    │   └─ Owner View Only
    ↓ 「権限割り当て」をクリック
[3] 割り当て完了
    │ - 権限ロールが保存される
    ↓
[4] スタッフ一覧画面（戻る）
```

関連ユースケース:
- 新規スタッフへの権限ロール割り当て

---

### フロー7: 権限ロール変更フロー

```
[1] スタッフ一覧画面
    ↓ 対象スタッフを選択 → 「権限変更」をクリック
[2] 権限変更画面
    │ - スタッフ情報が表示される
    │ - 現在の権限ロールが表示される
    │ - 権限変更履歴が表示される
    │ - 新しい権限ロールを選択
    │ - 変更理由を入力（必須・監査ログ用）
    ↓ 「権限変更実行」をクリック
[3] 確認ダイアログ
    ↓ 「確認」をクリック
[4] 変更完了
    │ - 権限ロールが更新される
    │ - 監査ログに自動記録される
    ↓
[5] スタッフ一覧画面（戻る）
```

関連ユースケース:
- 異動に伴う権限ロール変更
- 権限変更の監査ログ自動記録

---

### フロー8: 権限設定状況確認フロー

```
[1] 権限検索画面
    │ - 全スタッフの権限一覧が表示される
    │ - フィルタ: 権限ロール
    │ - フィルタ: 部署
    │ - フィルタ: ステータス
    ↓ 「検索」をクリック
[2] 権限検索画面（検索結果）
    │ - 該当スタッフの権限設定一覧が表示される
    │ - 不適切な設定をチェック
    │
    ├─→ [権限変更画面へ] → [権限変更画面]（是正が必要な場合）
    │
    └─→ [CSVエクスポート] → CSVファイルダウンロード（監査用）
```

関連ユースケース:
- 全スタッフの権限設定状況確認
- 権限ロールや部署での絞り込み検索

---

## 主要な画面遷移

### スタッフ一覧画面 → スタッフ登録画面

- **起点**: スタッフ一覧画面
- **終点**: スタッフ登録画面
- **トリガー**: 「新規登録」ボタンをクリック
- **条件**: なし
- **関連ユースケース**: 新規スタッフの登録とアカウント発行
- **備考**: 登録完了後はスタッフ一覧画面に戻る

### スタッフ一覧画面 → スタッフ更新画面

- **起点**: スタッフ一覧画面
- **終点**: スタッフ更新画面
- **トリガー**: スタッフを選択後「編集」ボタンをクリック
- **条件**: スタッフが選択されていること
- **関連ユースケース**: スタッフ情報の更新
- **備考**: 更新完了後はスタッフ一覧画面に戻る

### スタッフ一覧画面 → スタッフ削除確認画面

- **起点**: スタッフ一覧画面
- **終点**: スタッフ削除確認画面
- **トリガー**: スタッフを選択後「削除」ボタンをクリック
- **条件**: スタッフが選択されていること
- **関連ユースケース**: 退職スタッフの削除とアカウント無効化
- **備考**: 削除実行前に確認ダイアログを表示

### スタッフ一覧画面 → パスワードリセット画面

- **起点**: スタッフ一覧画面
- **終点**: パスワードリセット画面
- **トリガー**: スタッフを選択後「パスワードリセット」ボタンをクリック
- **条件**: スタッフが選択されていること
- **関連ユースケース**: パスワード忘れ時のリセット対応
- **備考**: 本人確認方法と理由の入力が必須

### スタッフ一覧画面 → 権限変更画面

- **起点**: スタッフ一覧画面
- **終点**: 権限変更画面
- **トリガー**: スタッフを選択後「権限変更」ボタンをクリック
- **条件**: スタッフが選択されていること
- **関連ユースケース**: 異動に伴う権限ロール変更
- **備考**: 変更理由は監査ログに自動記録される

### 権限検索画面 → 権限変更画面

- **起点**: 権限検索画面
- **終点**: 権限変更画面
- **トリガー**: 「権限変更画面へ」ボタンをクリック
- **条件**: スタッフが選択されていること
- **関連ユースケース**: 権限ロールや部署での絞り込み検索
- **備考**: 不適切な権限設定の是正時に使用

---

## 外部システム連携

### メール配信サービス

| 画面 | 連携内容 |
|------|----------|
| スタッフ登録画面 | 初期パスワード通知メールの送信 |
| パスワードリセット画面 | 仮パスワード通知メールの送信 |
| パスワードリセット画面 | セキュリティインシデント時の緊急通知 |

---

## エラーフロー

### メールアドレス重複エラー

```
[スタッフ登録画面] または [スタッフ更新画面]
    ↓ 「登録」または「更新」をクリック
[バリデーションエラー]
    │ - 「このメールアドレスは既に使用されています」
    ↓ エラーメッセージを表示
[同画面に留まる]
    │ - メールアドレスを修正して再送信
```

### 本人確認未実施エラー

```
[パスワードリセット画面]
    ↓ 本人確認方法を選択せずに「リセット実行」
[バリデーションエラー]
    │ - 「本人確認方法を選択してください」
    ↓ エラーメッセージを表示
[同画面に留まる]
    │ - 本人確認方法を選択して再実行
```

### 変更理由未入力エラー

```
[権限変更画面]
    ↓ 変更理由を入力せずに「権限変更実行」
[バリデーションエラー]
    │ - 「変更理由を入力してください（監査ログに記録されます）」
    ↓ エラーメッセージを表示
[同画面に留まる]
    │ - 変更理由を入力して再実行
```

---

## 備考

- すべての画面は人事担当者のみアクセス可能
- 権限変更操作はすべて監査ログに自動記録される
- スタッフ削除時はアカウントが自動的に無効化される
- 6種類の権限ロール: Admin, Reservation Manager, Front Desk, Housekeeping, Accounting, Owner View Only
