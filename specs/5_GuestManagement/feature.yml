actor:
  - name: フロントスタッフ
    description: チェックイン・チェックアウト処理を担当する宿泊施設の従業員。宿泊者名簿の確認、部屋のアサイン、精算処理を行い、ゲストに快適な滞在を提供することが主な責務。

  - name: ゲスト
    description: 宿泊施設を利用する顧客。チェックイン前に宿泊者名簿を記入し、予約内容の確認や事前要望の入力を行う。

external_system:
  - name: メール配信システム
    description: チェックイン案内メールやエラー通知などのメールを自動送信する外部サービス。トークン付き一時URLをゲストに配信する。

aggregate:
  - 予約
  - 宿泊者名簿
  - トークン
  - 部屋

feature:
  - name: チェックイン案内メールを送信する
    description: チェックイン前日の予約を自動抽出し、24時間有効なトークン付き一時URLを含む案内メールをゲストに送信する。これにより、ゲストは事前に宿泊者名簿を記入でき、チェックイン時の待ち時間を短縮できる。
    events:
      - チェックイン案内メールが送信された
      - メール送信が失敗した
    policy:
      - name: 前日予約抽出ポリシー
        trigger: 毎日定刻（システムスケジュール）
        action: チェックイン前日の予約を抽出し、案内メール送信対象リストを作成する
      - name: メール送信失敗記録ポリシー
        trigger: メール送信が失敗した
        action: エラー情報を記録し、フロントスタッフに通知する
    scenarios:
      - name: チェックイン前日の一括案内メール送信フロー
        precondition: 翌日チェックイン予定の予約が存在し、メール配信システムが稼働している
        steps:
          - システムがチェックイン前日の予約を自動抽出する
          - 各予約に対して24時間有効なトークンを発行する
          - トークン付き宿泊者名簿記入URLを生成する
          - ゲストのメールアドレス宛に案内メールを送信する
          - 送信結果を記録し、宿泊者名簿記入状態を「記入依頼送信済み」に更新する
        postcondition: 対象ゲストに案内メールが送信され、トークンが発行済み状態になる
      - name: メール送信失敗時の対応フロー
        precondition: 案内メール送信処理が実行され、一部のメールが送信失敗した
        steps:
          - システムがメール送信エラーを検知する
          - エラー情報（対象予約、エラー理由）を記録する
          - フロントスタッフに送信失敗を通知する
          - フロントスタッフが対象ゲストへの対応方法を検討する
        postcondition: 送信失敗が記録され、フロントスタッフが把握している状態になる

  - name: 宿泊者名簿を記入する
    description: ゲストがトークン付き一時URLにアクセスし、宿泊者名簿（氏名・住所など）を入力・保存する。セキュアなトークン認証により、本人のみが記入可能な仕組みを提供する。
    events:
      - トークンが検証された
      - トークンが期限切れになった
      - 宿泊者名簿が保存された
    policy:
      - name: トークン使用済み更新ポリシー
        trigger: 宿泊者名簿が保存された
        action: 使用されたトークンを「使用済み」状態に更新する
      - name: 名簿記入状態更新ポリシー
        trigger: 宿泊者名簿が保存された
        action: 宿泊者名簿記入状態を「記入完了」に更新する
    scenarios:
      - name: ゲストによる事前宿泊者名簿記入フロー
        precondition: ゲストが案内メールを受信し、トークンが有効期限内である
        steps:
          - ゲストが案内メール内のURLをクリックする
          - システムがトークンの有効性を検証する
          - 予約情報と宿泊者名簿入力フォームが表示される
          - ゲストが氏名・住所・連絡先などの必要事項を入力する
          - 入力内容を確認し、保存ボタンを押す
          - 宿泊者名簿が保存され、完了メッセージが表示される
        postcondition: 宿泊者名簿が記入完了状態になり、トークンが使用済みになる
      - name: トークン期限切れ時のフロー
        precondition: ゲストが案内メール内のURLにアクセスしたが、24時間を超過している
        steps:
          - ゲストが案内メール内のURLをクリックする
          - システムがトークンの有効期限を検証する
          - トークンが期限切れであることを検出する
          - 期限切れメッセージを表示し、フロントへの連絡を促す
        postcondition: ゲストがフロントでの記入が必要であることを認識する

  - name: 宿泊者名簿を管理する
    description: フロントスタッフが宿泊者名簿の検索・確認・未記入者の把握を行い、旅館業法に基づき3年間保管する。チェックイン前に記入状況を確認し、未記入の場合はフロントでの記入を促す。
    events:
      - 宿泊者名簿が検索された
      - 宿泊者名簿が確認された
      - 宿泊者名簿が保管された
    policy:
      - name: 名簿3年保管ポリシー
        trigger: 宿泊者名簿が保管された
        action: 旅館業法に基づき、宿泊者名簿を3年間保管する
    scenarios:
      - name: チェックイン前の宿泊者名簿確認フロー
        precondition: 本日チェックイン予定の予約が存在する
        steps:
          - フロントスタッフが本日チェックイン予定の予約一覧を表示する
          - 各予約の宿泊者名簿記入状況を確認する
          - 未記入の予約を特定し、リストアップする
          - 該当ゲスト到着時にフロントでの記入を促す準備をする
        postcondition: 未記入者が把握され、チェックイン時の対応準備が完了している
      - name: 宿泊者名簿検索・閲覧フロー
        precondition: フロントスタッフがログイン済みで、検索対象の情報を把握している
        steps:
          - フロントスタッフが宿泊者名簿検索画面を開く
          - 氏名・宿泊日・予約番号などの条件を入力する
          - 検索結果から該当する宿泊者名簿を選択する
          - 宿泊者名簿の詳細情報を確認する
        postcondition: 目的の宿泊者名簿が表示され、内容を確認できる

  - name: チェックイン処理を行う
    description: フロントスタッフがゲスト到着時にチェックイン処理を行う。宿泊者名簿の記入状況確認、部屋の最終アサイン、チェックイン完了記録を通じて、ゲストに鍵を渡すまでの一連の手続きを効率的に実施する。
    events:
      - ゲストが到着した
      - 宿泊者名簿記入状況が確認された
      - 部屋がアサインされた
      - チェックインが完了した
    policy:
      - name: 名簿未記入時対応ポリシー
        trigger: 宿泊者名簿記入状況が確認された
        action: 未記入の場合、フロントでの即時記入を促す
      - name: 部屋状態更新ポリシー
        trigger: チェックインが完了した
        action: アサインされた部屋の状態を「使用中」に更新する
    scenarios:
      - name: 事前記入済みゲストのスムーズチェックインフロー
        precondition: ゲストが到着し、宿泊者名簿が事前に記入済みである
        steps:
          - ゲストがフロントに到着し、予約名を告げる
          - フロントスタッフが予約を検索し、宿泊者名簿記入状況を確認する
          - 記入済みの宿泊者名簿内容を画面で確認する
          - 部屋番号を最終確定し、ゲストに案内する
          - チェックイン完了を記録し、鍵を渡す
        postcondition: チェックインが完了し、ゲストが部屋に向かえる状態になる
      - name: 宿泊者名簿未記入時のチェックインフロー
        precondition: ゲストが到着したが、宿泊者名簿が未記入である
        steps:
          - ゲストがフロントに到着し、予約名を告げる
          - フロントスタッフが予約を検索し、宿泊者名簿が未記入であることを確認する
          - ゲストにフロントでの宿泊者名簿記入を依頼する
          - ゲストが紙またはタブレットで宿泊者名簿を記入する
          - フロントスタッフが記入内容を確認し、システムに登録する
          - 部屋番号を確定し、チェックイン完了を記録する
        postcondition: 宿泊者名簿が記入され、チェックインが完了する

  - name: チェックアウト処理を行う
    description: フロントスタッフがゲスト退出時にチェックアウト処理を行う。精算内容の確認・表示、チェックアウト完了記録、部屋状態のDirty変更を通じて、次のゲスト受入準備につなげる。
    events:
      - 精算内容が表示された
      - チェックアウトが完了した
      - 部屋状態がDirtyに変更された
    policy:
      - name: 清掃依頼自動作成ポリシー
        trigger: チェックアウトが完了した
        action: 部屋状態をDirtyに変更し、清掃対象リストに追加する
    scenarios:
      - name: 通常チェックアウトフロー
        precondition: ゲストがチェックアウト時刻に退出を希望している
        steps:
          - ゲストがフロントに来て、チェックアウトを申し出る
          - フロントスタッフが予約を検索し、精算内容を表示する
          - 宿泊料金・追加料金を確認し、ゲストに説明する
          - 精算処理を行う（現金・カード等）
          - チェックアウト完了を記録する
          - 部屋状態をDirtyに変更し、清掃チームに通知する
        postcondition: チェックアウトが完了し、部屋が清掃待ち状態になる
      - name: 追加料金発生時のチェックアウトフロー
        precondition: ゲストの滞在中に追加料金（ミニバー、ルームサービス等）が発生している
        steps:
          - ゲストがフロントに来て、チェックアウトを申し出る
          - フロントスタッフが予約を検索し、精算内容を表示する
          - 基本宿泊料金と追加料金の内訳を確認する
          - 追加料金の内容をゲストに説明し、了承を得る
          - 合計金額を精算する
          - チェックアウト完了を記録し、部屋状態を更新する
        postcondition: 追加料金を含む精算が完了し、チェックアウトが記録される
