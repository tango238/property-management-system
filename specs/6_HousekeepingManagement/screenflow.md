# 画面遷移図 - 清掃管理

## 概要

清掃管理機能は、宿泊施設のチェックアウト後の部屋清掃を効率的に管理するためのシステムです。清掃スタッフがモバイルデバイスでリアルタイムに清掃状況を更新し、フロントスタッフが部屋の準備状況を即座に把握できることで、ゲストへの迅速なチェックイン対応を実現します。

## ユーザーロール

- **清掃スタッフ**: 客室の清掃業務を担当。モバイルデバイスで清掃対象の確認、作業記録、備品不足の報告を行う
- **フロントスタッフ**: フロント業務を担当。清掃状況の確認、清掃完了通知の受信、チェックイン対応を行う

---

## 清掃スタッフ ユーザーフロー

### メインフロー: 清掃業務の一連フロー

```
[1] 清掃管理ダッシュボード
    │
    ↓ 「清掃対象一覧へ」を押下
    │
[2] 清掃対象部屋一覧画面
    │
    ├─→ フィルター適用（フロア/部屋タイプ/清掃状態）
    │
    ↓ 部屋を選択
    │
[3] 清掃作業記録画面
    │
    ├─→ 「清掃開始」を押下（状態: Dirty → Cleaning）
    │   │
    │   ↓ 清掃作業実施
    │   │
    │   ├─→ 「清掃完了」を押下（状態: Cleaning → Inspected）
    │   │   │
    │   │   ↓ 点検実施
    │   │   │
    │   │   └─→ 「Vacant状態に変更」を押下（状態: Inspected → Vacant）
    │   │       │
    │   │       ↓ プッシュ通知自動送信
    │   │       │
    │   │       └─→ [2] 清掃対象部屋一覧画面へ戻る
    │   │
    │   └─→ 備品不足発見時 → [4] 備品不足記録画面へ
    │
    └─→ 「戻る」を押下 → [2] 清掃対象部屋一覧画面へ
```

関連ユースケース:
- 清掃対象部屋一覧の確認
- 清掃優先順位の確認
- 清掃開始の記録
- 清掃完了の記録
- 部屋のVacant状態への変更
- 清掃完了通知の送信
- 清掃業務の一連フロー実行

---

### サブフロー: 備品不足記録と補充依頼

```
[3] 清掃作業記録画面
    │
    ↓ 備品不足を発見
    │
[4] 備品不足記録画面
    │
    ├─→ 備品情報を入力
    │   ├── 備品種類を選択（タオル類/アメニティ/リネン類等）
    │   ├── 備品名を入力
    │   ├── 不足数量を入力
    │   ├── 状態を選択（不足/破損/汚損）
    │   ├── 破損写真を添付（任意）
    │   └── 備考を入力（任意）
    │
    ├─→ 「記録を保存」を押下
    │   │
    │   └─→ [3] 清掃作業記録画面へ戻る
    │
    ├─→ 「補充依頼へ進む」を押下
    │   │
    │   ↓
    │   │
    │   [5] 備品補充依頼画面
    │       │
    │       ├─→ 緊急度を選択（通常/急ぎ/緊急）
    │       ├─→ 補充希望時刻を指定（任意）
    │       ├─→ 連絡事項を入力（任意）
    │       │
    │       ├─→ 「補充依頼を送信」を押下
    │       │   │
    │       │   └─→ [3] 清掃作業記録画面へ戻る
    │       │
    │       └─→ 「戻る」を押下 → [4] 備品不足記録画面へ
    │
    └─→ 「キャンセル」を押下 → [3] 清掃作業記録画面へ
```

関連ユースケース:
- 備品不足の記録
- 備品補充依頼の送信

---

### サブフロー: 通知確認

```
[1] 清掃管理ダッシュボード
    │
    ↓ 「通知」タブを選択 または プッシュ通知受信
    │
[6] 通知一覧画面（清掃スタッフ）
    │
    ├─→ フィルター適用（通知種別/既読・未読）
    │
    ├─→ 「通知を確認」を押下
    │   │
    │   └─→ 通知を既読に変更
    │
    └─→ 「詳細を見る」を押下
        │
        └─→ 補充完了の場合 → 補充詳細を表示
```

関連ユースケース:
- 補充完了通知の受信

---

## フロントスタッフ ユーザーフロー

### メインフロー: 部屋状況確認とチェックイン対応

```
[7] 部屋状況一覧画面
    │
    ├─→ フィルター適用（フロア/部屋タイプ/部屋状態/清掃状態）
    │
    ├─→ 「更新」を押下 → 最新状況を取得
    │
    ├─→ 「部屋詳細を見る」を押下
    │   │
    │   └─→ 部屋詳細情報を表示
    │
    └─→ 「チェックイン処理へ」を押下
        │
        └─→ チェックイン画面へ遷移（外部）
```

関連ユースケース:
- 清掃状況のリアルタイム確認（フロント）

---

### サブフロー: 清掃完了通知受信からチェックイン

```
プッシュ通知受信
    │
    ↓
[8] 清掃完了通知画面
    │
    ├─→ 通知内容を確認
    │   ├── 部屋番号
    │   ├── 部屋タイプ
    │   ├── 清掃完了時刻
    │   ├── 次のチェックイン時刻
    │   └── ゲスト名
    │
    ├─→ 「通知を確認」を押下
    │   │
    │   └─→ 通知を既読に変更
    │
    ├─→ 「チェックイン処理へ」を押下
    │   │
    │   └─→ チェックイン画面へ遷移（外部）
    │
    └─→ 「部屋状況一覧へ」を押下
        │
        └─→ [7] 部屋状況一覧画面へ
```

関連ユースケース:
- 清掃完了通知の受信と確認
- チェックイン待ちゲストへの迅速対応

---

## 画面一覧

| No. | 画面名 | アクター | 主な目的 |
|-----|--------|----------|----------|
| 1 | 清掃管理ダッシュボード | 清掃スタッフ | 清掃業務の全体状況把握 |
| 2 | 清掃対象部屋一覧画面 | 清掃スタッフ | 清掃対象の確認と優先順位表示 |
| 3 | 清掃作業記録画面 | 清掃スタッフ | 清掃開始・完了・Vacant変更の記録 |
| 4 | 備品不足記録画面 | 清掃スタッフ | 備品不足・破損の記録 |
| 5 | 備品補充依頼画面 | 清掃スタッフ | 補充依頼の送信 |
| 6 | 通知一覧画面（清掃スタッフ） | 清掃スタッフ | 補充完了通知の確認 |
| 7 | 部屋状況一覧画面 | フロントスタッフ | 全部屋の清掃状況確認 |
| 8 | 清掃完了通知画面 | フロントスタッフ | 清掃完了通知の受信・確認 |

---

## 主要な画面遷移

### 清掃開始の記録

- **遷移元**: 清掃対象部屋一覧画面
- **遷移先**: 清掃作業記録画面
- **トリガー**: 部屋を選択
- **条件**: 部屋がDirty状態であること
- **関連ユースケース**: 清掃開始の記録
- **備考**: 清掃開始ボタン押下で状態がCleaningに遷移

### 清掃完了からVacant変更

- **遷移元**: 清掃作業記録画面
- **遷移先**: 清掃対象部屋一覧画面
- **トリガー**: Vacant状態に変更ボタン押下
- **条件**: 部屋がInspected状態であること
- **関連ユースケース**: 部屋のVacant状態への変更、清掃完了通知の送信
- **備考**: Vacant変更時にフロントスタッフへ自動通知

### 備品不足記録から補充依頼

- **遷移元**: 備品不足記録画面
- **遷移先**: 備品補充依頼画面
- **トリガー**: 補充依頼へ進むボタン押下
- **条件**: 備品種類と備品名が入力済み
- **関連ユースケース**: 備品不足の記録、備品補充依頼の送信
- **備考**: 緊急度と希望時刻を指定して依頼送信

### 清掃完了通知からチェックイン

- **遷移元**: 清掃完了通知画面
- **遷移先**: チェックイン画面（外部）
- **トリガー**: チェックイン処理へボタン押下
- **条件**: 部屋がVacant状態であること
- **関連ユースケース**: チェックイン待ちゲストへの迅速対応
- **備考**: 待機中ゲストへの迅速な対応を実現

---

## 外部連携

### プッシュ通知サービス

| 連携ポイント | 連携内容 |
|--------------|----------|
| 清掃作業記録画面 | Vacant状態変更時に通知送信 |
| 清掃完了通知画面 | 清掃完了通知の受信 |
| 通知一覧画面（清掃スタッフ） | 補充完了通知の受信 |

---

## エラーフロー

### 状態遷移エラー

```
[3] 清掃作業記録画面
    │
    ├─→ Dirty以外の状態で「清掃開始」押下
    │   │
    │   └─→ エラーメッセージ: 「Dirty状態の部屋のみ清掃開始できます」
    │
    ├─→ Cleaning以外の状態で「清掃完了」押下
    │   │
    │   └─→ エラーメッセージ: 「Cleaning状態の部屋のみ清掃完了できます」
    │
    └─→ Inspected以外の状態で「Vacant変更」押下
        │
        └─→ エラーメッセージ: 「Inspected状態の部屋のみVacant変更できます」
```

### 入力バリデーションエラー

```
[4] 備品不足記録画面
    │
    └─→ 備品種類または備品名が未入力で「記録を保存」押下
        │
        └─→ エラーメッセージ: 「備品種類と備品名は必須です」
```

---

## 備考

- 清掃スタッフ向け画面はすべてモバイル対応（レスポンシブデザイン）
- 部屋状態の遷移は Dirty → Cleaning → Inspected → Vacant の順でのみ可能
- 次のチェックイン時刻が2時間以内の部屋は高優先度として赤色で表示
- 清掃完了通知はリアルタイムでフロントスタッフに配信
